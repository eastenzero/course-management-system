<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’è¯¾APIè°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; background: #1890ff; color: white; cursor: pointer; }
        button:hover { background: #40a9ff; }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ’è¯¾APIè°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-section">
        <h2>1. æ¨¡æ‹ŸAPIè°ƒç”¨æµ‹è¯•</h2>
        <button onclick="testMockAPI()">æµ‹è¯• Mock Schedule API</button>
        <div id="mock-api-result"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. ç›´æ¥æ•°æ®è®¿é—®æµ‹è¯•</h2>
        <button onclick="testDirectData()">æµ‹è¯•ç›´æ¥æ•°æ®è®¿é—®</button>
        <div id="direct-data-result"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. æ•°æ®æ ¼å¼éªŒè¯</h2>
        <button onclick="validateDataFormat()">éªŒè¯æ•°æ®æ ¼å¼</button>
        <div id="format-validation-result"></div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿ mockScheduleAPI çš„è¡Œä¸º
        const mockScheduleAPI = {
            getSchedules: async (params = {}) => {
                console.log('ğŸš€ è°ƒç”¨ mockScheduleAPI.getSchedules:', params);
                
                try {
                    // æ¨¡æ‹Ÿæˆ‘ä»¬çš„å®é™…APIè°ƒç”¨
                    const response = await fetch('http://localhost:8080/data/schedules.json');
                    if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                    
                    const data = await response.json();
                    console.log('ğŸ“Š åŸå§‹æ•°æ®:', data);
                    
                    let schedules = data.schedules || [];
                    console.log('ğŸ“‹ æ€»è®°å½•æ•°:', schedules.length);
                    
                    // åº”ç”¨è¿‡æ»¤
                    if (params.semester) {
                        schedules = schedules.filter(s => s.semester === params.semester);
                    }
                    if (params.teacher) {
                        schedules = schedules.filter(s => s.teacher.includes(params.teacher));
                    }
                    if (params.classroom) {
                        schedules = schedules.filter(s => s.classroom.includes(params.classroom));
                    }
                    
                    // æ¨¡æ‹Ÿåˆ†é¡µ
                    const page = params.page || 1;
                    const pageSize = params.page_size || 10;
                    const start = (page - 1) * pageSize;
                    const end = start + pageSize;
                    
                    const paginatedSchedules = schedules.slice(start, end);
                    
                    console.log('ğŸ“„ åˆ†é¡µç»“æœ:', {
                        page, pageSize, start, end,
                        paginatedCount: paginatedSchedules.length
                    });
                    
                    return {
                        data: {
                            count: schedules.length,
                            next: end < schedules.length ? `?page=${page + 1}` : null,
                            previous: page > 1 ? `?page=${page - 1}` : null,
                            results: paginatedSchedules
                        }
                    };
                    
                } catch (error) {
                    console.error('âŒ APIè°ƒç”¨å¤±è´¥:', error);
                    throw error;
                }
            }
        };

        // æµ‹è¯•å‡½æ•°
        window.testMockAPI = async () => {
            const resultEl = document.getElementById('mock-api-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await mockScheduleAPI.getSchedules({
                    semester: '2024æ˜¥',
                    page: 1,
                    page_size: 5
                });
                
                const data = response.data;
                let html = '<span class="success">âœ… Mock API è°ƒç”¨æˆåŠŸ</span>';
                html += `<p>ğŸ“Š æ€»è®°å½•æ•°: ${data.count}</p>`;
                html += `<p>ğŸ“„ å½“å‰é¡µè®°å½•æ•°: ${data.results.length}</p>`;
                html += `<p>ğŸ”— åˆ†é¡µ: ${data.previous || 'æ— '} | ${data.next || 'æ— '}</p>`;
                
                if (data.results.length > 0) {
                    html += '<h4>æ ·ä¾‹æ•°æ®:</h4>';
                    data.results.slice(0, 2).forEach(schedule => {
                        html += `
                            <div style="background: #f5f5f5; padding: 10px; margin: 5px 0; border-radius: 5px;">
                                <strong>${schedule.courseName}</strong><br>
                                ğŸ‘¨â€ğŸ« ${schedule.teacher} | ğŸ« ${schedule.classroom}<br>
                                â° å‘¨${schedule.dayOfWeek} ${schedule.startTime}-${schedule.endTime}
                            </div>
                        `;
                    });
                }
                
                resultEl.innerHTML = html;
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ Mock API è°ƒç”¨å¤±è´¥: ${error.message}</span>`;
                console.error('Mock APIæµ‹è¯•å¤±è´¥:', error);
            }
        };

        window.testDirectData = async () => {
            const resultEl = document.getElementById('direct-data-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch('http://localhost:8080/data/schedules.json');
                const data = await response.json();
                
                let html = '<span class="success">âœ… ç›´æ¥æ•°æ®è®¿é—®æˆåŠŸ</span>';
                html += `<p>ğŸ“Š æ€»è¯¾ç¨‹æ•°: ${data.schedules.length}</p>`;
                html += `<p>ğŸ“… å­¦æœŸ: ${data.semester}</p>`;
                html += `<p>â° ç”Ÿæˆæ—¶é—´: ${data.generated_at}</p>`;
                
                resultEl.innerHTML = html;
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ ç›´æ¥æ•°æ®è®¿é—®å¤±è´¥: ${error.message}</span>`;
            }
        };

        window.validateDataFormat = async () => {
            const resultEl = document.getElementById('format-validation-result');
            resultEl.innerHTML = 'éªŒè¯ä¸­...';
            
            try {
                const response = await fetch('http://localhost:8080/data/schedules.json');
                const data = await response.json();
                
                let html = '<h4>æ•°æ®æ ¼å¼éªŒè¯ç»“æœ:</h4>';
                let hasErrors = false;
                
                // æ£€æŸ¥é¡¶å±‚ç»“æ„
                if (!data.schedules || !Array.isArray(data.schedules)) {
                    html += '<span class="error">âŒ scheduleså­—æ®µç¼ºå¤±æˆ–ä¸æ˜¯æ•°ç»„</span><br>';
                    hasErrors = true;
                } else {
                    html += '<span class="success">âœ… scheduleså­—æ®µå­˜åœ¨ä¸”æ˜¯æ•°ç»„</span><br>';
                }
                
                if (!data.total) {
                    html += '<span class="warning">âš ï¸ totalå­—æ®µç¼ºå¤±</span><br>';
                } else {
                    html += '<span class="success">âœ… totalå­—æ®µå­˜åœ¨</span><br>';
                }
                
                if (!data.semester) {
                    html += '<span class="warning">âš ï¸ semesterå­—æ®µç¼ºå¤±</span><br>';
                } else {
                    html += '<span class="success">âœ… semesterå­—æ®µå­˜åœ¨</span><br>';
                }
                
                // æ£€æŸ¥å•ä¸ªè¯¾ç¨‹è®°å½•çš„æ ¼å¼
                if (data.schedules && data.schedules.length > 0) {
                    const firstSchedule = data.schedules[0];
                    const requiredFields = ['id', 'courseCode', 'courseName', 'teacher', 'classroom', 'dayOfWeek', 'startTime', 'endTime', 'semester'];
                    
                    html += '<h5>å¿…éœ€å­—æ®µæ£€æŸ¥:</h5>';
                    requiredFields.forEach(field => {
                        if (firstSchedule.hasOwnProperty(field)) {
                            html += `<span class="success">âœ… ${field}</span><br>`;
                        } else {
                            html += `<span class="error">âŒ ${field}</span><br>`;
                            hasErrors = true;
                        }
                    });
                }
                
                if (!hasErrors) {
                    html += '<br><span class="success"><strong>âœ… æ•°æ®æ ¼å¼éªŒè¯é€šè¿‡ï¼</strong></span>';
                } else {
                    html += '<br><span class="error"><strong>âŒ æ•°æ®æ ¼å¼å­˜åœ¨é”™è¯¯</strong></span>';
                }
                
                resultEl.innerHTML = html;
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ æ•°æ®æ ¼å¼éªŒè¯å¤±è´¥: ${error.message}</span>`;
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”§ è°ƒè¯•å·¥å…·å·²åŠ è½½');
            testDirectData(); // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        });
    </script>
</body>
</html>