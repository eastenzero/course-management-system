# 校园课程管理系统 - 项目启动和健康检测指南

## 📋 概述

本文档提供了校园课程管理系统的完整启动流程和健康检测方法，包括前端、后端和数据库的连接性检测。

## 🏗️ 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 (React)   │    │  后端 (Django)   │    │ 数据库 (PostgreSQL)│
│   端口: 8081    │◄──►│   端口: 8000    │◄──►│   端口: 5432    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │  缓存 (Redis)   │
                       │   端口: 6379    │
                       └─────────────────┘
```

## 🚀 快速启动

### 方法一：使用健康检查脚本（推荐）

#### Windows 用户
```batch
# 运行批处理脚本（最简单）
.\quick-health-check.bat

# 或使用 PowerShell 脚本（功能更全）
.\system-health-check.ps1 -Action start

# 仅检查系统状态
.\system-health-check.ps1 -Action check
```

#### Linux/Mac 用户
```bash
# 使用 Python 脚本
python system-health-check.py start

# 仅检查系统状态
python system-health-check.py check

# 使用原有的 Shell 脚本
./quick-start.sh
```

### 方法二：手动启动

```bash
# 1. 启动所有服务
docker-compose up -d

# 2. 等待服务启动（约15秒）
# 3. 运行数据库迁移
docker-compose exec backend python manage.py migrate

# 4. 创建超级用户（可选）
docker-compose exec backend python manage.py createsuperuser

# 5. 检查服务状态
docker-compose ps
```

## 🔍 健康检查详解

### 1. 系统先决条件检查

- **Docker**: 版本 20.0+ 
- **Docker Compose**: 版本 2.0+
- **Node.js**: 版本 18+ (仅开发模式需要)
- **Python**: 版本 3.11+ (仅开发模式需要)

### 2. 服务连接性检查

#### 数据库连接检查
```bash
# 检查端口
netstat -an | grep :5432

# 检查数据库状态
docker-compose exec db pg_isready -U postgres

# 测试数据库连接
docker-compose exec db psql -U postgres -d course_management -c "SELECT version();"
```

#### Redis 连接检查
```bash
# 检查端口
netstat -an | grep :6379

# 检查 Redis 状态
docker-compose exec redis redis-cli ping
```

#### 后端服务检查
```bash
# 检查端口
netstat -an | grep :8000

# 检查健康端点
curl http://localhost:8000/api/health/

# 检查 API 文档
curl http://localhost:8000/api/docs/
```

#### 前端服务检查
```bash
# 检查端口（Docker 模式）
netstat -an | grep :8081

# 检查前端页面
curl http://localhost:8081

# 检查开发模式端口
netstat -an | grep :3000
```

## 📊 服务状态监控

### 实时监控命令

```bash
# 查看所有服务状态
docker-compose ps

# 查看服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f db
docker-compose logs -f redis

# 查看资源使用情况
docker stats
```

### 健康检查端点

| 服务 | 端点 | 预期响应 |
|------|------|----------|
| 后端健康检查 | `GET /api/health/` | `{"status": "ok", "message": "Backend is running"}` |
| 数据库 | `pg_isready -U postgres` | `accepting connections` |
| Redis | `redis-cli ping` | `PONG` |
| 前端 | `GET /` | HTTP 200 |

## 🔧 故障排除

### 常见问题及解决方案

#### 1. Docker 服务启动失败
```bash
# 检查 Docker 是否运行
docker info

# 重新构建镜像
docker-compose build --no-cache

# 清理并重新启动
docker-compose down -v
docker-compose up -d
```

#### 2. 数据库连接失败
```bash
# 检查数据库容器状态
docker-compose logs db

# 重启数据库服务
docker-compose restart db

# 检查数据库配置
docker-compose exec db env | grep POSTGRES
```

#### 3. 后端服务异常
```bash
# 查看后端日志
docker-compose logs backend

# 进入后端容器调试
docker-compose exec backend bash

# 检查 Django 配置
docker-compose exec backend python manage.py check
```

#### 4. 前端页面无法访问
```bash
# 检查前端构建
docker-compose logs frontend

# 重新构建前端
docker-compose build frontend
docker-compose up -d frontend
```

#### 5. 端口冲突
```bash
# 查看端口占用
netstat -tulpn | grep :8000
netstat -tulpn | grep :8081
netstat -tulpn | grep :5432
netstat -tulpn | grep :6379

# 停止冲突的服务或修改 docker-compose.yml 中的端口映射
```

## 🎯 访问信息

### 系统访问地址

- **前端应用**: http://localhost:8081
- **后端 API**: http://localhost:8000
- **API 文档**: http://localhost:8000/api/docs/
- **管理后台**: http://localhost:8000/admin
- **数据库**: localhost:5432
- **Redis**: localhost:6379

### 测试账号

| 角色 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| 管理员 | admin | admin123 | 系统管理员，拥有所有权限 |
| 教师 | teacher1 | teacher123 | 教师账号，可管理课程和学生 |
| 学生 | student1 | student123 | 学生账号，可查看课程表 |

## 📈 性能监控

### 系统资源监控
```bash
# 查看容器资源使用
docker stats

# 查看系统负载
top
htop

# 查看磁盘使用
df -h
docker system df
```

### 数据库性能监控
```bash
# 查看数据库连接数
docker-compose exec db psql -U postgres -c "SELECT count(*) FROM pg_stat_activity;"

# 查看数据库大小
docker-compose exec db psql -U postgres -c "SELECT pg_size_pretty(pg_database_size('course_management'));"
```

## 🔄 维护操作

### 日常维护命令
```bash
# 备份数据库
docker-compose exec db pg_dump -U postgres course_management > backup.sql

# 恢复数据库
docker-compose exec -T db psql -U postgres course_management < backup.sql

# 清理 Docker 资源
docker system prune -f

# 更新系统
git pull
docker-compose build
docker-compose up -d
```

### 日志管理
```bash
# 清理日志
docker-compose logs --tail=0 -f > /dev/null

# 设置日志轮转（在 docker-compose.yml 中）
logging:
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"
```

## 📞 技术支持

如果遇到问题，请按以下顺序排查：

1. 运行健康检查脚本获取详细状态
2. 查看相关服务日志
3. 检查系统资源使用情况
4. 参考故障排除章节
5. 联系技术支持团队

---

**最后更新**: 2024年8月29日  
**版本**: v1.0  
**维护者**: 课程管理系统开发团队
