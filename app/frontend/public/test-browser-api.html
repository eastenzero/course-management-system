<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨APIæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .schedule-item { background: white; margin: 5px 0; padding: 10px; border-left: 3px solid #1890ff; }
    </style>
</head>
<body>
    <h1>ğŸŒ æµè§ˆå™¨ç¯å¢ƒAPIæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. åŸºç¡€æ•°æ®åŠ è½½æµ‹è¯•</h2>
        <button onclick="testBasicLoading()">æµ‹è¯•åŸºç¡€æ•°æ®åŠ è½½</button>
        <div id="basic-loading-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. æ¨¡æ‹ŸReactç»„ä»¶æ•°æ®åŠ è½½</h2>
        <button onclick="testReactComponent()">æ¨¡æ‹ŸReactç»„ä»¶è¡Œä¸º</button>
        <div id="react-component-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. é”™è¯¯å¤„ç†æµ‹è¯•</h2>
        <button onclick="testErrorHandling()">æµ‹è¯•é”™è¯¯å¤„ç†</button>
        <div id="error-handling-result"></div>
    </div>

    <script>
        // æ¨¡æ‹ŸsimpleScheduleAPIçš„è¡Œä¸ºï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰
        const browserScheduleAPI = {
            getSchedules: async (params = {}) => {
                console.log('ğŸ“¡ æµè§ˆå™¨ç¯å¢ƒAPIè°ƒç”¨:', params);
                
                try {
                    // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡Viteä»£ç†
                    const response = await fetch('/data/schedules.json');
                    if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                    
                    const data = await response.json();
                    console.log('ğŸ“Š è·å–åˆ°çš„æ•°æ®:', data);
                    
                    let schedules = data.schedules || [];
                    
                    // åº”ç”¨è¿‡æ»¤
                    if (params.semester) {
                        schedules = schedules.filter(s => s.semester === params.semester);
                    }
                    if (params.teacher) {
                        schedules = schedules.filter(s => s.teacher.includes(params.teacher));
                    }
                    
                    // æ¨¡æ‹Ÿåˆ†é¡µ
                    const page = params.page || 1;
                    const pageSize = params.page_size || 10;
                    const start = (page - 1) * pageSize;
                    const end = start + pageSize;
                    
                    const paginatedSchedules = schedules.slice(start, end);
                    
                    console.log('ğŸ“„ åˆ†é¡µç»“æœ:', {
                        originalCount: schedules.length,
                        page, pageSize, start, end,
                        paginatedCount: paginatedSchedules.length
                    });
                    
                    return {
                        data: {
                            count: schedules.length,
                            next: end < schedules.length ? `?page=${page + 1}` : null,
                            previous: page > 1 ? `?page=${page - 1}` : null,
                            results: paginatedSchedules
                        }
                    };
                    
                } catch (error) {
                    console.error('âŒ APIè°ƒç”¨å¤±è´¥:', error);
                    return {
                        data: {
                            count: 0,
                            next: null,
                            previous: null,
                            results: []
                        }
                    };
                }
            }
        };

        // æµ‹è¯•1: åŸºç¡€æ•°æ®åŠ è½½
        window.testBasicLoading = async () => {
            const resultEl = document.getElementById('basic-loading-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch('/data/schedules.json');
                if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                
                const data = await response.json();
                
                let html = '<span class="success">âœ… åŸºç¡€æ•°æ®åŠ è½½æˆåŠŸ</span>';
                html += `<p>ğŸ“Š æ€»è¯¾ç¨‹æ•°: ${data.schedules.length}</p>`;
                html += `<p>ğŸ“… å­¦æœŸ: ${data.semester}</p>`;
                
                if (data.schedules.length > 0) {
                    html += '<h4>æ ·ä¾‹æ•°æ®:</h4>';
                    data.schedules.slice(0, 2).forEach(schedule => {
                        html += `
                            <div class="schedule-item">
                                <strong>${schedule.courseName}</strong> (${schedule.courseCode})<br>
                                ğŸ‘¨â€ğŸ« ${schedule.teacher} | ğŸ« ${schedule.classroom}<br>
                                â° å‘¨${schedule.dayOfWeek} ${schedule.startTime}-${schedule.endTime}
                            </div>
                        `;
                    });
                }
                
                resultEl.innerHTML = html;
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ åŸºç¡€æ•°æ®åŠ è½½å¤±è´¥: ${error.message}</span>`;
                console.error('åŸºç¡€æ•°æ®åŠ è½½å¤±è´¥:', error);
            }
        };

        // æµ‹è¯•2: æ¨¡æ‹ŸReactç»„ä»¶
        window.testReactComponent = async () => {
            const resultEl = document.getElementById('react-component-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await browserScheduleAPI.getSchedules({
                    semester: '2024æ˜¥',
                    page: 1,
                    page_size: 5
                });
                
                const data = response.data;
                let html = '<span class="success">âœ… Reactç»„ä»¶æ¨¡æ‹ŸæˆåŠŸ</span>';
                html += `<p>ğŸ“Š æ€»è®°å½•æ•°: ${data.count}</p>`;
                html += `<p>ğŸ“„ å½“å‰é¡µè®°å½•æ•°: ${data.results.length}</p>`;
                html += `<p>ğŸ”— åˆ†é¡µ: ${data.previous || 'æ— '} | ${data.next || 'æ— '}</p>`;
                
                if (data.results.length > 0) {
                    html += '<h4>å½“å‰é¡µæ•°æ®:</h4>';
                    data.results.forEach(schedule => {
                        html += `
                            <div class="schedule-item">
                                <strong>${schedule.courseName}</strong> (${schedule.courseCode})<br>
                                ğŸ‘¨â€ğŸ« ${schedule.teacher} | ğŸ« ${schedule.classroom}<br>
                                â° å‘¨${schedule.dayOfWeek} ${schedule.startTime}-${schedule.endTime}
                            </div>
                        `;
                    });
                }
                
                resultEl.innerHTML = html;
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ Reactç»„ä»¶æ¨¡æ‹Ÿå¤±è´¥: ${error.message}</span>`;
                console.error('Reactç»„ä»¶æ¨¡æ‹Ÿå¤±è´¥:', error);
            }
        };

        // æµ‹è¯•3: é”™è¯¯å¤„ç†
        window.testErrorHandling = async () => {
            const resultEl = document.getElementById('error-handling-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                // æµ‹è¯•ä¸å­˜åœ¨çš„æ–‡ä»¶
                const response = await fetch('/data/nonexistent.json');
                if (response.ok) {
                    throw new Error('æ„å¤–çš„æˆåŠŸå“åº”');
                }
                
                resultEl.innerHTML = '<span class="success">âœ… é”™è¯¯å¤„ç†æ­£å¸¸</span><p>404é”™è¯¯è¢«æ­£ç¡®æ•è·å’Œå¤„ç†</p>';
                
            } catch (error) {
                resultEl.innerHTML = `<span class="success">âœ… é”™è¯¯å¤„ç†æ­£å¸¸</span><p>ç½‘ç»œé”™è¯¯è¢«æ­£ç¡®æ•è·: ${error.message}</p>`;
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª æµè§ˆå™¨APIæµ‹è¯•å·¥å…·å·²åŠ è½½');
            testBasicLoading(); // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        });
    </script>
</body>
</html>