<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORSä¿®å¤æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; background: #1890ff; color: white; cursor: pointer; }
        button:hover { background: #40a9ff; }
    </style>
</head>
<body>
    <h1>ğŸŒ CORSè·¨åŸŸä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. ç›´æ¥æ•°æ®è®¿é—®æµ‹è¯•</h2>
        <button onclick="testDirectAccess()">æµ‹è¯•ç›´æ¥è®¿é—®æ•°æ®æœåŠ¡</button>
        <div id="direct-access-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ä»£ç†æ•°æ®è®¿é—®æµ‹è¯•</h2>
        <button onclick="testProxyAccess()">æµ‹è¯•é€šè¿‡å‰ç«¯ä»£ç†è®¿é—®</button>
        <div id="proxy-access-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. æ¨¡æ‹Ÿå‰ç«¯ç»„ä»¶æµ‹è¯•</h2>
        <button onclick="testFrontendComponent()">æµ‹è¯•æ¨¡æ‹Ÿå‰ç«¯ç»„ä»¶æ•°æ®åŠ è½½</button>
        <div id="frontend-component-result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. CORSå¤´éªŒè¯</h2>
        <button onclick="testCORSHeaders()">éªŒè¯CORSå¤´ä¿¡æ¯</button>
        <div id="cors-headers-result"></div>
    </div>

    <script>
        // æµ‹è¯•1: ç›´æ¥æ•°æ®è®¿é—®
        window.testDirectAccess = async () => {
            const resultEl = document.getElementById('direct-access-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch('http://localhost:8080/data/schedules.json');
                if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                
                const data = await response.json();
                resultEl.innerHTML = '<span class="success">âœ… ç›´æ¥æ•°æ®è®¿é—®æˆåŠŸ</span>';
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ ç›´æ¥æ•°æ®è®¿é—®å¤±è´¥: ${error.message}</span>`;
            }
        };

        // æµ‹è¯•2: é€šè¿‡ä»£ç†è®¿é—®
        window.testProxyAccess = async () => {
            const resultEl = document.getElementById('proxy-access-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch('/data/schedules.json');
                if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                
                const data = await response.json();
                resultEl.innerHTML = '<span class="success">âœ… ä»£ç†æ•°æ®è®¿é—®æˆåŠŸ</span>';
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ ä»£ç†æ•°æ®è®¿é—®å¤±è´¥: ${error.message}</span>`;
            }
        };

        // æµ‹è¯•3: æ¨¡æ‹Ÿå‰ç«¯ç»„ä»¶
        window.testFrontendComponent = async () => {
            const resultEl = document.getElementById('frontend-component-result');
            resultEl.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                // æ¨¡æ‹ŸsimpleScheduleAPIçš„è¡Œä¸º
                const response = await fetch('/data/schedules.json');
                if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                
                const data = await response.json();
                
                // æ¨¡æ‹Ÿåˆ†é¡µå’Œè¿‡æ»¤
                const page = 1;
                const pageSize = 5;
                const start = (page - 1) * pageSize;
                const end = start + pageSize;
                
                const schedules = data.schedules || [];
                const paginatedSchedules = schedules.slice(start, end);
                
                const result = {
                    count: schedules.length,
                    next: end < schedules.length ? `?page=${page + 1}` : null,
                    previous: page > 1 ? `?page=${page - 1}` : null,
                    results: paginatedSchedules
                };
                
                let html = '<span class="success">âœ… å‰ç«¯ç»„ä»¶æ¨¡æ‹ŸæˆåŠŸ</span>';
                html += `<p>ğŸ“Š æ€»è®°å½•æ•°: ${result.count}</p>`;
                html += `<p>ğŸ“„ å½“å‰é¡µè®°å½•æ•°: ${result.results.length}</p>`;
                html += `<p>ğŸ”— åˆ†é¡µ: ${result.previous || 'æ— '} | ${result.next || 'æ— '}</p>`;
                
                if (result.results.length > 0) {
                    html += '<h4>æ ·ä¾‹æ•°æ®:</h4>';
                    result.results.slice(0, 2).forEach(schedule => {
                        html += `
                            <div style="background: #f5f5f5; padding: 10px; margin: 5px 0; border-radius: 5px;">
                                <strong>${schedule.courseName}</strong> (${schedule.courseCode})<br>
                                ğŸ‘¨â€ğŸ« ${schedule.teacher} | ğŸ« ${schedule.classroom}<br>
                                â° å‘¨${schedule.dayOfWeek} ${schedule.startTime}-${schedule.endTime}
                            </div>
                        `;
                    });
                }
                
                resultEl.innerHTML = html;
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ å‰ç«¯ç»„ä»¶æ¨¡æ‹Ÿå¤±è´¥: ${error.message}</span>`;
            }
        };

        // æµ‹è¯•4: CORSå¤´éªŒè¯
        window.testCORSHeaders = async () => {
            const resultEl = document.getElementById('cors-headers-result');
            resultEl.innerHTML = 'éªŒè¯ä¸­...';
            
            try {
                const response = await fetch('http://localhost:8080/data/schedules.json');
                const headers = response.headers;
                
                let html = '<h4>å“åº”å¤´ä¿¡æ¯:</h4>';
                html += `<p>Access-Control-Allow-Origin: ${headers.get('Access-Control-Allow-Origin') || 'æœªè®¾ç½®'}</p>`;
                html += `<p>Access-Control-Allow-Methods: ${headers.get('Access-Control-Allow-Methods') || 'æœªè®¾ç½®'}</p>`;
                html += `<p>Access-Control-Allow-Headers: ${headers.get('Access-Control-Allow-Headers') || 'æœªè®¾ç½®'}</p>`;
                html += `<p>Content-Type: ${headers.get('Content-Type') || 'æœªè®¾ç½®'}</p>`;
                
                const hasCORS = headers.get('Access-Control-Allow-Origin') !== null;
                html += `<br>${hasCORS ? '<span class="success">âœ… CORSå¤´å·²æ­£ç¡®é…ç½®</span>' : '<span class="error">âŒ CORSå¤´æœªé…ç½®</span>'}`;
                
                resultEl.innerHTML = html;
                
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ CORSå¤´éªŒè¯å¤±è´¥: ${error.message}</span>`;
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª CORSæµ‹è¯•å·¥å…·å·²åŠ è½½');
            testProxyAccess(); // è‡ªåŠ¨è¿è¡Œä»£ç†æµ‹è¯•
        });
    </script>
</body>
</html>