## 教师与学生界面改造参考文档（主题可选 + iOS16 毛玻璃风格）

### 文档概览
- 目标：在不改变业务流程/接口的前提下，提升界面的亲和与愉悦度，支持用户自选主题（预设与自定义），引入 iOS16 风格毛玻璃（Glassmorphism/Vibrancy）质感
- 读者：产品、设计、前端、测试、可访问性与性能审核
- 范围：视觉与品牌、主题与令牌、组件与页面规范、动效、可访问性、性能、埋点、验收与测试
- 不在范围：后端数据结构、角色权限、业务流程调整

---

## 1. 视觉与品牌基调

### 1.1 主题风格定位
- 学生端（推荐默认）：Monet 粉彩，柔和友好、轻盈明快
- 教师端（推荐默认）：Morandi 低饱和中性色，克制、专业但亲和
- 用户可在任意端切换主题；也可跟随系统浅/深色

### 1.2 语气与文案
- 友好、鼓励、简洁，避免术语堆砌与过度严肃
- 空状态与反馈采用“建议 + 下一步操作”组合文案

---

## 2. 主题体系（预设与自定义）

### 2.1 预设主题（Light/Dark）
- Monet Light
  - Primary #A7C7E7；Accent1 #B8D8C0；Accent2 #C9B7DD；Accent3 #F2C6CF；Highlight #F6D365
  - Bg #F6E7D8；Surface #EDEDED；Border #E6E6E6；Text P #2E3238；Text S #5C6470
- Morandi Light
  - Primary #A3B1C6；Accent1 #B8C4B8；Accent2 #BFA5A0；Accent3 #C7A49A
  - Bg #D8D2C8；Surface #B8B5B9；Border #D1D0CC；Text P #59606D；Text S #7A828E
- Dark 模式
  - 派生原则：保持色相与饱和度相对稳定，降低明度、提升对比度；示例 Text P #E8EAED、Text S #B0B6BF

状态色（固定，不随主题变化以保持语义一致）：
- Success #3CB371；Warning #F4B740；Error #E25555；Info #5AA0F0

### 2.2 自定义主题（用户可选）
- 允许设置主色 Accent（必填）与次色 Accent-2（可选）
- 提供色相/饱和/亮度选择与“可读性安全区”提示（实时对比度校验）
- 亮/暗模式成对生成，避免反相导致对比不足
- 角色默认：学生=Monet、教师=Morandi；可被用户覆盖（账号全端/仅此设备）

---

## 3. 设计令牌（Design Tokens）

### 3.1 令牌命名（语义化）
- 颜色
  - --color-primary, --color-accent-1/2/3
  - --color-bg, --color-surface, --color-surface-variant
  - --color-text-primary, --color-text-secondary, --color-border
  - --color-success, --color-warning, --color-error, --color-info
- 质感与动效
  - --glass-bg, --glass-blur, --glass-saturate, --glass-border, --glass-shadow, --glass-noise-opacity
  - --duration-fast(150ms), --duration-medium(220ms), --easing-standard(cubic-bezier(0.2,0,0,1))
- 结构
  - --radius-sm(8px), --radius-md(12px), --radius-lg(16px)
  - --space-xxs..xl（4/8/12/16/24/32）
  - --shadow-sm/md/lg（透明度、扩散按比例梯度）

### 3.2 色阶与交互态生成
- 使用 OKLCH/OKLab 在感知空间生成 8–10 阶梯
- Hover 提升亮度 ΔL，小幅增饱和；Active 降低亮度 ΔL
- Focus 使用可见描边或外环，满足无障碍焦点可见性

### 3.3 对比度护栏
- 文本/图标与承载背景对比度 ≥ 4.5:1（AA）
- 若用户选择导致不足：自动切换文字到高对比色或微调明度（提示用户）

---

## 4. iOS16 毛玻璃（Glassmorphism/Vibrancy）

### 4.1 默认参数
- 模糊：blur(20px)；饱和：saturate(1.2)
- 浅色 glass-bg: rgba(255,255,255,0.40)
- 深色 glass-bg: rgba(20,22,26,0.35)
- 内发光高光边：1px（浅 rgba(255,255,255,0.45) / 深 rgba(255,255,255,0.25)）
- 阴影：0 8px 24px rgba(0,0,0,0.08)；噪点叠加：4–6%

### 4.2 使用场景
- 适用：顶部导航/工具条、抽屉/模态、非密集信息卡片、浮动操作区
- 谨慎/禁用：数据密集表格主体、长正文、复杂图片背景承载文本

### 4.3 回退策略
- 不支持 backdrop-filter 时：半透明纯色背景（与 glass-bg 同色）+ 清晰边框；移除模糊/噪点
- 提供 -webkit-backdrop-filter 前缀

### 4.4 可访问性
- 玻璃层承载文本必须达 AA；背景复杂时自动加遮罩（纯色或渐变 8–16%）

---

## 5. 组件规范（关键）

### 5.1 卡片（课程/任务/公告）
- 圆角：12–14px；内部留白：md
- 标题/副标题/元信息层级固定；状态徽章与进度条使用语义令牌
- 玻璃版（用于首页关键区块）：启用 glass 令牌；扁平版用于数据密集区

### 5.2 按钮
- 语义：Primary/Secondary/Tertiary/Destructive
- 交互态：hover/active/focus/disabled 派生自主色/中性色阶
- 图标按钮需可见焦点环，支持仅图标与图标+文案两种密度

### 5.3 徽章与标签
- 尺寸：sm/md；状态色固定映射；可选轻微动画（出现/计数增长 150–200ms）

### 5.4 进度与反馈
- 条形/环形进度；完成时 250ms 轻点亮
- Toast/通知统一样式（玻璃/扁平两版），信息层级明确

### 5.5 表单与校验
- 行内校验与错误定位；帮助说明与占位符文案统一语气
- 复杂发布流程使用分步表单（教师端）

---

## 6. 页面规范（学生/教师）

### 6.1 学生端
- 首页
  - 首屏“继续学习”卡（玻璃态，强调 CTA）
  - 次级：今日待办/即将到期卡片，使用 Accent 徽章
- 课程页
  - 章节卡片化；完成勾选轻微点亮；资源预览统一播放器皮肤
- 任务/作业
  - 截止时间、预计时长清晰；“开始/继续”按钮靠近标题区；提交成功有轻反馈

### 6.2 教师端
- 仪表盘
  - 工具条玻璃态（略低透明度以显稳重）；KPI 卡片扁平+轻阴影
- 批改面板
  - 主内容高对比扁平；右侧评分栏可用玻璃态但保证可读性与键盘可达
- 资源库
  - 卡片 Morandi 低饱和；悬停提升与阴影统一 200–220ms

---

## 7. 动效与微交互

### 7.1 时间与曲线
- 进入/展开：200–220ms；完成/成功：250ms
- 悬停：提升 4–6px 阴影，轻位移或缩放 1.02 倍
- 标准缓动：cubic-bezier(0.2,0,0,1)

### 7.2 骨架与加载
- 骨架屏统一灰阶/形状；渐进加载避免闪烁

### 7.3 减少动态效果
- 尊重系统“减少动态效果”设置：降低动效强度/关闭噪点

---

## 8. 可访问性（WCAG 2.1 AA）

- 对比度：文本/图标 ≥ 4.5:1；非文字 UI 元素 ≥ 3:1
- 键盘：所有可交互元素可达；可见焦点环；焦点顺序与视觉一致
- 读屏：关键组件有 ARIA 标签；错误优先朗读；状态变化有辅助文本
- 表单：错误定位与提示清晰；说明性文本与 placeholder 区分
- 玻璃态文本：必要时自动加深背景或加描边/投影提升可读性

---

## 9. 性能与约束

- 玻璃容器同屏大面积 ≤ 3；小组件可增加但避免叠层
- GPU 加速（transform/opacity）；减少昂贵滤镜重绘范围
- 主题切换仅替换 CSS 变量（不重建组件树）
- 首屏策略：先读本地主题再尝试服务端同步，避免闪烁

---

## 10. 主题选择 UX 与持久化

- 入口：设置 > 外观；头部提供快速切换
- 预览：右侧实时预览关键组件/页面（过渡 220ms）
- 持久化：
  - 登录：后端用户偏好字段 + 前端 localStorage 兜底
  - 未登录：仅前端本地
- 同步模式：账号全端/仅此设备；可切换
- 回退：无法读取主题时使用预设默认（学生 Monet / 教师 Morandi）

---

## 11. 技术落地（前端实现）

### 11.1 CSS 变量与主题切换
- 根节点 data-theme 与 data-mode 切换语义令牌
- 组件严禁硬编码色值，全部引用令牌

示例（CSS 片段）：
```css
:root[data-theme="monet"][data-mode="light"]{
  --color-primary:#A7C7E7; --color-accent-1:#B8D8C0; --color-bg:#F6E7D8;
  --color-surface:#EDEDED; --color-text-primary:#2E3238; --color-border:#E6E6E6;
  --glass-bg:rgba(255,255,255,0.40); --glass-blur:20px; --glass-saturate:1.2;
  --glass-border:rgba(255,255,255,0.45); --glass-shadow:0 8px 24px rgba(0,0,0,0.08);
  --glass-noise-opacity:0.05;
}
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturate));
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturate));
  box-shadow: var(--glass-shadow);
  border: 1px solid var(--glass-border);
}
```

### 11.2 主题 JSON 结构（预设与自定义通用）
```json
{
  "name": "Monet Light",
  "mode": "light",
  "colors": {
    "primary": "#A7C7E7",
    "accent1": "#B8D8C0",
    "accent2": "#C9B7DD",
    "accent3": "#F2C6CF",
    "bg": "#F6E7D8",
    "surface": "#EDEDED",
    "surfaceVariant": "#F5F5F5",
    "textPrimary": "#2E3238",
    "textSecondary": "#5C6470",
    "border": "#E6E6E6",
    "success": "#3CB371",
    "warning": "#F4B740",
    "error": "#E25555",
    "info": "#5AA0F0"
  },
  "glass": {
    "bg": "rgba(255,255,255,0.40)",
    "blur": "20px",
    "saturate": 1.2,
    "border": "rgba(255,255,255,0.45)",
    "shadow": "0 8px 24px rgba(0,0,0,0.08)",
    "noiseOpacity": 0.05
  },
  "motion": { "durationFast": "150ms", "durationMedium": "220ms", "easing": "cubic-bezier(0.2, 0, 0, 1)" }
}
```

### 11.3 自定义主题生成与对比度纠偏（伪算法）
- 输入：主色 H,S,L（或 OKLCH）
- 生成：Light/Dark 色阶与交互态（hover/active/focus）
- 校验：文本/图标与背景对比度 ≥ 4.5：1
- 若不达标：自动将文本切换为高对比色（通常为近黑/近白），或微调 L 值直至达标
- 输出：主题 JSON + 映射到 CSS 变量

---

## 12. 埋点与度量（分析）

- 事件
  - appearance_open, theme_preset_select, theme_custom_pick, theme_contrast_warning, theme_save, theme_reset
  - glass_heavy_view_open（同屏玻璃大容器超过阈值）
- 指标
  - 7/30天主题留存；切换后撤回率；对比度警告率；性能（FCP/LCP/CLS）
  - 关键任务完成时间（学生继续学习/教师待批改）

---

## 13. 验收标准

- 主题切换：≤200ms，无“闪白/闪黑”；滚动位置与交互状态保持
- 可读性：预设与自定义主题下关键文本对比度达 AA；玻璃层承载文本可读
- 视觉一致：组件间圆角、阴影、动效时长/曲线一致；跨页面无突兀高饱和
- 性能：上线后 FCP/LCP 不劣化超过 5%；同屏玻璃大容器 ≤ 3
- 回退：不支持滤镜环境下视觉/交互可用

---

## 14. 测试用例清单（要点）

### 14.1 视觉/主题
- 切换 Monet/Morandi/System 与自定义主题：颜色、阴影、圆角、动效统一
- 暗色模式：文本/图标对比达标；插画/图标在暗色下可识别

### 14.2 玻璃态
- 支持与回退（含 Safari/低端设备）：模糊、饱和、边框、阴影、噪点正确/回退正确
- 复杂背景下文字可读性自动加深/遮罩生效

### 14.3 可访问性
- 键盘导航顺序正确；焦点环可见；ARIA 标签与朗读行为正确
- 表单错误朗读与定位；动效尊重“减少动态效果”

### 14.4 性能
- 同屏玻璃容器数量/面积限制；切换主题不引发大面积 reflow
- GPU 加速路径（transform/opacity）验证

### 14.5 功能与持久化
- 登录/未登录持久化与优先级（账号全端 vs 仅此设备）
- 首屏读取回退策略；异常恢复默认主题

---

## 15. 版本推进与回滚

- 阶段化上线：令牌与组件皮肤 → 关键页面 → 主题设置与自定义
- 监控：上线后 1 周持续观察性能与关键转化；必要时临时关闭大面积玻璃
- 回滚：保留旧皮肤变量映射与切换开关，支持快速回退

---

## 16. 附录

### 16.1 变量总表（建议）
- 颜色：primary, accent-1..3, bg, surface, surface-variant, text-primary/secondary, border, success/warning/error/info
- 质感：glass-bg/blur/saturate/border/shadow/noise-opacity
- 动效：duration-fast/medium, easing-standard
- 结构：radius-sm/md/lg, space-xxs..xl, shadow-sm/md/lg

### 16.2 玻璃态组件示例（结构）
```html
<div class="glass toolbar">
  <div class="toolbar-left">...</div>
  <div class="toolbar-right">...</div>
</div>
```

### 16.3 对比度检测（思路）
- 将颜色转换为线性 sRGB/OKLCH 计算相对亮度
- 使用 WCAG 公式计算对比度；小组件实时提示“良好/需优化”
- 低对比时：提升文字对比（切换至 #111/#fff）或加背景遮罩（8–16%）

---

## 结语与交付物清单

- 主题预设令牌表（Monet/Morandi，Light/Dark，含 CSS 变量映射）
- 自定义主题生成与对比度纠偏说明（OKLCH/阈值）
- 玻璃态规范与回退策略（参数、场景、可访问性）
- 关键页面高保真原型（学生：主页/课程/任务；教师：仪表盘/课程管理/批改）
- 组件库皮肤映射表（语义令牌 → 组件属性）
- 测试用例文档（可访问性/性能/主题/回退）
- 实施指南（变量命名、主题 JSON 结构、持久化字段、首屏策略）

